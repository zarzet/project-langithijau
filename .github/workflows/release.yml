name: Build and Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Java 25
      uses: actions/setup-java@v4
      with:
        distribution: 'oracle'
        java-version: '25'
        cache: 'maven'
        
    - name: Build with Maven
      run: mvn clean package -DskipTests
      
    - name: Get version
      id: version
      run: |
        [xml]$pom = Get-Content pom.xml
        $version = $pom.project.version
        echo "VERSION=$version" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding utf8 -Append
      shell: pwsh
      
    - name: Create Release
      uses: softprops/action-gh-release@v1
      if: startsWith(github.ref, 'refs/tags/')
      with:
        files: |
          target/adaptive-study-planner-*.jar
          src/main/resources/credentials.json.example
        body: |
          ## Adaptive Study Planner v${{ steps.version.outputs.VERSION }}
          
          ### Download
          
          Download file JAR di bawah dan jalankan dengan:
          ```bash
          java -jar adaptive-study-planner-${{ steps.version.outputs.VERSION }}.jar
          ```
          
          ### Setup Credentials
          
          1. Download `credentials.json.example`
          2. Rename menjadi `credentials.json`
          3. Isi dengan Google OAuth credentials Anda
          4. Simpan di folder yang sama dengan JAR
          
          **Panduan lengkap**: Lihat [DEPLOYMENT.md](https://github.com/${{ github.repository }}/blob/main/DEPLOYMENT.md)
          
          ### What's New
          
          - Modern Material Design 3 UI
          - Google OAuth 2.0 Login
          - Spaced Repetition Algorithm (SM-2)
          - Dark Mode Support
          - Interactive Dashboard Widgets
          
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
